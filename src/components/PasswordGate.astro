---
import siteConfig from '../content/site-config.json';

const { personal } = siteConfig;
---

<div id="password-gate" class="password-gate">
  <div class="gate-content">
    <h1 class="gate-name">{personal.name}</h1>
    <p class="gate-title">{personal.title}</p>

    <form id="password-form" class="password-form">
      <input
        type="password"
        id="password-input"
        class="password-input"
        placeholder="Enter password"
        autocomplete="off"
        autofocus
      />
      <button type="submit" class="password-submit">Enter</button>
    </form>
    <p id="password-error" class="password-error"></p>
  </div>
</div>

<script>
  const PASSWORD = 'portfolio';
  const STORAGE_KEY = 'portfolio-auth';

  function checkAuth() {
    return localStorage.getItem(STORAGE_KEY) === 'true';
  }

  function hideGate() {
    const gate = document.getElementById('password-gate');
    if (gate) {
      gate.classList.add('hidden');
      setTimeout(() => {
        gate.style.display = 'none';
      }, 300);
    }
  }

  function showError() {
    const error = document.getElementById('password-error');
    const input = document.getElementById('password-input') as HTMLInputElement;
    if (error) {
      error.textContent = 'Incorrect password';
      error.classList.add('visible');
    }
    if (input) {
      input.classList.add('shake');
      setTimeout(() => input.classList.remove('shake'), 500);
      input.value = '';
      input.focus();
    }
  }

  // Check on load
  if (checkAuth()) {
    const gate = document.getElementById('password-gate');
    if (gate) gate.style.display = 'none';
  }

  // Handle form submit
  const form = document.getElementById('password-form');
  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    const input = document.getElementById('password-input') as HTMLInputElement;
    const value = input?.value || '';

    if (value === PASSWORD) {
      localStorage.setItem(STORAGE_KEY, 'true');
      hideGate();
    } else {
      showError();
    }
  });
</script>

<style>
  .password-gate {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background-color: var(--bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  .password-gate.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .gate-content {
    text-align: center;
    padding: var(--spacing-lg);
  }

  .gate-name {
    font-family: var(--font-family-heading);
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    letter-spacing: 0.02em;
  }

  .gate-title {
    font-size: clamp(1rem, 2vw, 1.25rem);
    color: var(--text-secondary);
    margin-bottom: 3rem;
    font-weight: 400;
  }

  .password-form {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }

  .password-input {
    width: 200px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    font-family: inherit;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    text-align: center;
    transition: border-color 0.2s ease;
  }

  .password-input:focus {
    outline: none;
    border-color: var(--text-muted);
  }

  .password-input::placeholder {
    color: var(--text-muted);
  }

  .password-input.shake {
    animation: shake 0.5s ease;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-8px); }
    40%, 80% { transform: translateX(8px); }
  }

  .password-submit {
    padding: 0.75rem 2rem;
    font-size: 0.875rem;
    font-family: inherit;
    font-weight: 500;
    background-color: var(--text-primary);
    color: var(--bg-primary);
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .password-submit:hover {
    background-color: var(--accent);
  }

  .password-error {
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #e57373;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .password-error.visible {
    opacity: 1;
  }
</style>
